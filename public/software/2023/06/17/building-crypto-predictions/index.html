<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SMBH4M85HZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-SMBH4M85HZ');
  </script>

  <title>Mariano Gappa&#39;s Blog</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/chroma.css">
  <link rel="icon" href="/favicon.ico">
  
</head>

<body>
  <header class="header-flex">
    <div class="site-title"><a href="/">Mariano Gappa&#39;s Blog</a></div>
    <nav>
      <ul>
        <li><a href="/about/">About</a></li>
        <li><a href="/projects/">Projects</a></li>
      </ul>
    </nav>
  </header>
  <main class="container">
    
<article class="post">
  <h1 class="post-title">Building Crypto Predictions Tracker: architecture and challenges</h1>
  <div class="post-meta">
    
    <span class="post-date">Jun 17, 2023</span>
    
    
  </div>
  
  <div class="post-image">
    <img src="/images/posts/building-crypto-predictions.png" alt="Building Crypto Predictions Tracker: architecture and challenges" class="featured-image">
  </div>
  
  <div class="post-content">
    <h2 id="tldr">TL;DR</h2>
<p>During the past year I&rsquo;ve gotten exposure to the cryptocurrency scene from an investment perspective. A key frustrating aspect of it is that there&rsquo;s no reliable source of investment advice. I describe this problem in detail on my previous blogpost: <a href="%7B%7Bsite.url%7D%7D/software/2022/08/25/cryptocurrency-influencers-are-preying-on-millennials-who-found-salvation-in-crypto/">Cryptocurrency influencers are preying on millennials who found salvation in crypto</a>.</p>
<p>I&rsquo;ve been working on a Go-based project to automatically track cryptocurrency predictions made on social networks like <a href="https://twitter.com/CryptoKaleo/status/1558313838877057025">this one</a> for the last 6 months, as a tool for accountability and influencer reputation. I think the resulting system ended up being pretty neat and it might interest you if you&rsquo;re a backend engineer. In this blogpost, I&rsquo;ll define this system and describe its architecture.</p>
<p>The backend system is available here: <a href="https://github.com/marianogappa/crypto-predictions">Crypto Predictions Tracker</a>.</p>
<p>A frontend to this project is this Twitter account: <a href="https://twitter.com/crypto_preds">Crypto Predictions Tracker</a>.</p>
<p>A key component of building this project was to consume cryptocurrency market data provided by exchanges. I&rsquo;ve open sourced a library that facilitates this task in a simple and efficient manner. The crypto-candles library is available <a href="https://github.com/marianogappa/crypto-candles">on Github</a> and its construction and features are described on my blogpost: <a href="%7B%7Bsite.url%7D%7D/software/2022/07/27/10-gotchas-for-building-a-universal-crypto-candlestick-iterator-in-go/">10 Gotchas for building a universal crypto candlestick iterator in Go</a>.</p>
<h2 id="motivation">Motivation</h2>
<p>A fundamental problem of available cryptocurrency-related investment advice on the Internet is that there is no track-record anywhere. Consider other businesses:</p>
<ul>
<li>
<p>Before making a hotel or restaurant booking, we can check their rating online on our phones.</p>
</li>
<li>
<p>Before making a decision on a rental flat or buying a house, we can compare neighbourhood prices and do inspections.</p>
</li>
<li>
<p>Before choosing an investment fund, we can check <a href="https://am.jpmorgan.com/us/en/asset-management/adv/tools/portfolio-tools/investment-comparison/">comparison studies</a> as well as the historical ROI of the chosen fund itself.</p>
</li>
</ul>
<p>Now consider examples of advice given by cryptocurrency influencers, like this one:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-0.png" alt="Example Tweet"></p>
<p>I&rsquo;m hoping most of you reading this right now will be thinking: &ldquo;why would anyone in their right mind follow the investment advice of some dude on the Internet?&rdquo;. I think so too. However, some of these influencers have more than a million followers! I think it&rsquo;s fair to assume that advice is being followed galore. For a more exhaustive read of this problem, please read my blogpost: <a href="%7B%7Bsite.url%7D%7D/software/2022/08/25/cryptocurrency-influencers-are-preying-on-millennials-who-found-salvation-in-crypto/">Cryptocurrency influencers are preying on millennials who found salvation in crypto</a>.</p>
<p>I don&rsquo;t think all advice is malintentioned, and even if it was, I don&rsquo;t think it should be banned or made illegal, the same way that I don&rsquo;t think smoking, drinking and drugs should be illegal either. However, some form of warning should be available for them, the same way that there are warnings on cigarette packs and ratings on restaurants and hotels. Then, influencers would have a track-record that keeps them honest, and individuals can make informed decisions. But is that possible?</p>
<p><img src="/images/posts/crypto-predictions-tobacco-warning.jpg" alt="Social Network Posts"></p>
<h2 id="key-insights-on-feasibility">Key Insights on feasibility</h2>
<p>Note how social network posts are particularly well-suited for keeping a track record:</p>
<p><img src="/images/posts/crypto_social_post.png" alt="Social Network Posts"></p>
<p>They have:</p>
<ul>
<li>
<p>a date</p>
</li>
<li>
<p>an owner</p>
</li>
<li>
<p>mostly reasonably un-editable content</p>
</li>
</ul>
<p>Provided that the content is specific enough, as in the above example, then one could manually go to the exchange&rsquo;s website every now and then and check the market pair&rsquo;s last value against the prediction. In most cases, it&rsquo;s important that the prediction has some deadline: otherwise either we could be checking forever, and besides there&rsquo;s little value on a prediction that can only become true eventually, but never times out and becomes false.</p>
<p>If this can be done manually, can it be automated?</p>
<p>Yes! All exchanges (mostly) provide free APIs to consume current and historical market pair data. Social networks also <del>have free APIs to consume public post metadata</del> (thank you <a href="https://techcrunch.com/2023/02/01/twitter-to-end-free-access-to-its-api/">Twitter</a> &amp; <a href="https://techcrunch.com/2023/04/18/reddit-will-begin-charging-for-access-to-its-api/">Reddit</a>).</p>
<h2 id="automating-the-system">Automating the system</h2>
<p>At a high level, automating tracking for one prediction looks like this:</p>
<p><img src="/images/posts/crypto-predictions-system-diagram.png" alt="Crypto Predictions System Diagram"></p>
<ul>
<li>
<p>Manually input the prediction metadata (e.g. who predicts, which market pair, by when, prediction condition) as an object/struct in memory.</p>
</li>
<li>
<p>Every minute or so, ask the exchange for the current last price of the market pair.</p>
</li>
<li>
<p>Upon receiving the new price, check if the prediction condition was met.</p>
</li>
<li>
<p>If condition met, prediction became true!</p>
</li>
<li>
<p>If condition stays false until deadline, prediction became false!</p>
</li>
</ul>
<h2 id="a-million-caveats">A million caveats</h2>
<p>While the above looks very simple, every bullet point is trickier than it looks, even before introducing architectural considerations.</p>
<p>Here are some illustrative examples:</p>
<ul>
<li>
<p>A prediction should ideally specify which exchange it is for. There is no one value for a given market pair, that is, the last price of Bitcoin against Tether can differ between the Binance exchange and the Coinbase exchange at the same timestamp, because the last price is defined by the order book, and different exchanges have different order books! This causes two problems: (1) this system must implement ALL exchange APIs, and (2) predictions that don&rsquo;t specify exchange cannot really be tracked accurately, although in practice some assumptions are reasonable.</p>
</li>
<li>
<p>Social networks don&rsquo;t reveal the timezone of post authors, authors don&rsquo;t specify which timezones they make their predictions for, and cryptocurrency influencers typically travel around a lot, so prediction deadlines are imprecise. The closer the deadline, the least precise is the tracking of the prediction.</p>
</li>
<li>
<p>In practice, &gt;80% of predictions are surprisingly homogeneous and simple in structure, in the form: &ldquo;Coin against Stablecoin will reach Value by Deadline&rdquo;. But for some outliers, the discussed algorithm of a prediction being false until it becomes true or times out doesn&rsquo;t work. For example, consider this one: &ldquo;Ethereum won&rsquo;t reach 3000 until December&rdquo;.</p>
</li>
<li>
<p>It would be very lucky if the system would always catch fresh predictions made just now, but in practice the system will input predictions made some time in the past, so old predictions have to &ldquo;catch up to the present&rdquo; by checking the evolution of price since the start of the prediction timestamp, to now. The API endpoints for historical prices and current prices are separate.</p>
</li>
<li>
<p>The last price for a market pair changes with every filled order. On an exchange with a very high volume of transactions, several hundreds of orders could be filled every second. Checking the condition for every order would be the most accurate way to evaluate the prediction, because in theory there could be a very short period of very high price volatility in which the prediction briefly becomes true, and we might miss this fact in an averaged bucket of orders. In practice, this would be unfeasible, especially if we&rsquo;re planning to do it for more than a single prediction.</p>
</li>
</ul>
<h2 id="architectural-building-blocks">Architectural building blocks</h2>
<p>At a minimum, these components are going to be required:</p>
<p>![Architecture](/images/posts/crypto-predictions -diagram-blogpost-1.png)</p>
<ul>
<li>
<p>Database: each prediction contains some metadata (e.g. who, what, when) and some state (e.g. last recorded price and when, status of prediction). This data should survive restarts and evolve in atomic steps.</p>
</li>
<li>
<p>Market requester: predictions evolve upon evaluating market data, so the system needs a component that knows how to talk to all Exchange APIs.</p>
</li>
<li>
<p>Social Network requester: predictions are created upon consuming social network post metadata (e.g. who, what, when), so the system needs a component that can request post metadata from e.g. Twitter.</p>
</li>
<li>
<p>Back Office: a minimal frontend to <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> predictions, and to see what happens to them.</p>
</li>
<li>
<p>Cron: a process that will evolve active predictions at regular intervals, with the newest market data.</p>
</li>
</ul>
<p>If we want the system to be useful to a larger population than just its creator, two extra components become relevant:</p>
<ul>
<li>
<p>Frontend: some UI to display the information created, like a website. It could also be some report export function.</p>
</li>
<li>
<p>API: since now there are three components reading data (Cron, Back Office and Frontend), and potentially the Frontend could be consumed by untrusted clients, it becomes important to have a unified interface for managing access to that data.</p>
</li>
</ul>
<h2 id="architectural-challenges">Architectural challenges</h2>
<h4 id="implementing-support-for-arbitrary-predictions">Implementing support for arbitrary predictions</h4>
<p>A prediction post can be as simple as &ldquo;Bitcoin will be worth 100K in 2022!&rdquo; which can be normalized (with some assumptions) to: &ldquo;BTC against USDT (Tether) in the Binance exchange (spot market as opposed to some other derivatives market) will be greater than or equal to $100,000 within the post&rsquo;s timestamp and the first second of Jan 1st, 2023&rdquo;. That prediction cannot become false before end of year.</p>
<p>As it turns out, 80% or more of the predictions are as simple as that example. Considering the most popular cryptocurrency influencers, there are mostly only a few prediction patterns in total.</p>
<p>Sometimes, an influencer will make their &ldquo;next run predictions&rdquo; like so:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-1.png" alt="Example Tweet"></p>
<p>If we want to support that, we need to add boolean operator support over the initial implementation.</p>
<p>It&rsquo;s quite common to see a pattern of &ldquo;If a cryptocurrency falls below X, it will go all the way down to Y&rdquo;. For example:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-2.png" alt="Example Tweet"></p>
<p>This prediction has two steps: a &ldquo;prerequisite&rdquo; which &ldquo;enables&rdquo; the prediction, and the prediction itself. If the &ldquo;prerequisite&rdquo; is not met, then the prediction is not false but &ldquo;annulled&rdquo;. Often, these predictions cannot be input because they lack specific deadlines.</p>
<p>Finally, some predictions become true if a condition is true until a deadline, like this one:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-3.png" alt="Example Tweet"></p>
<p>This prediction breaks the model in which a prediction is false unless it becomes true before some deadline.</p>
<p>There are more edge cases, but they are less common, so I won&rsquo;t mention them here. I&rsquo;ve implemented support for many of these patterns and others, and in my experience the problem is not at all the coding &amp; testing involved: the real issue is the UI for inputting and for showing the status of predictions. Rather than providing so much flexibility, it works a lot better to offer a few pre-baked templates, and enable UI support for those.</p>
<h4 id="requesting-market-data">Requesting market data</h4>
<p>Predictions posted online tend to follow market trends, so the most popular cryptocurrencies get the most predictions, somewhat following the <a href="https://en.wikipedia.org/wiki/Pareto_principle">80/20 Pareto principle</a>. This means that, if we have 100 predictions and we evolve them every minute, we&rsquo;re gonna be making a lot of identical requests to the exchange&rsquo;s APIs. This is not just very inefficient but also unlikely to last long, because as the number of predictions grow, very soon the exchange&rsquo;s APIs will ban our IPs and ask us to enhance our calm.</p>
<p>The simplest solution to this problem is to cache market responses. In theory, this makes perfect sense, since one wouldn&rsquo;t expect historical market data to change. In practice, this is almost true, but one should be careful to consider some received data point &ldquo;final&rdquo;, since very recent data might be &ldquo;still getting aggregated&rdquo;, and exchanges do not clarify if a data point is final or not. A mitigation is to not consume very recent data points.</p>
<p>Note that the caching component is very valuable, but in a very small window of time. It&rsquo;s not common to need to request old data, because most predictions are about future deadlines. Thus, it&rsquo;s not necessary to build a full-fledged solution for caching.</p>
<h4 id="storing-predictions-and-evolving-them">Storing predictions and evolving them</h4>
<p>Predictions are esentially state machines, and they have two parts: metadata (e.g. author, deadline, conditions), and state (e.g. last timestamp requested for each market pair, status of condition(s) that compose the prediction).</p>
<p>Only the state part evolves over time. On each evolution step, one needs to request the latest data points for the involved market pairs, re-evaluate the prediction condition(s) and possibly change the status of it to &ldquo;correct&rdquo;/&ldquo;incorrect&rdquo;.</p>
<p>Further, out of the database of predictions, only a subset evolves: the active predictions. However, the state part of all active predictions must be updated every time. This write pattern suggests using some in-memory layer before reaching the durable store to alleviate disk pressure and latency, although then if someone kicks the power cable progress is lost.</p>
<p>Of course, for a small project that is just starting up and where cost is a major concern, a batch update statement on a small Postgres instance is more than enough. In order to set up the project for growth, we can just hide the storage layer implementation details behind a simple interface.</p>
<h4 id="predictions-tend-to-have-a-common-deadline">Predictions tend to have a common deadline</h4>
<p>End of year, end of month, or whenever a big event will take place (e.g. whenever the <a href="https://www.investopedia.com/terms/c/consumerpriceindex.asp">CPI</a> is going to be announced, whenever <a href="https://www.investopedia.com/bitcoin-halving-4843769">the halving</a> happens) are very common instants for predictions. This is absolutely fine in terms of evolving the predictions, but if one plans to trigger some actions like sending out notifications, instant hotspots could be problematic.</p>
<p>Possible mitigations are to buffer and aggregate notifications, or to cap the amount of notifications that can be sent in a given time period.</p>
<h2 id="takeaways-from-tracking-predictions-for-the-last-few-months">Takeaways from tracking predictions for the last few months</h2>
<p>A key criticism for this project is that it is pointless to track what influencers say, because no one in their right mind should take their advice when they make their investment decisions. If you share this point of view (like me!), wouldn&rsquo;t it be useful to be able to answer how often predictions become correct?</p>
<h4 id="how-often-do-predictions-become-correct">How often do predictions become correct?</h4>
<p>Well, thanks to this project, I can answer that! Results have caveats (e.g. some influencers make more specific predictions than others, averaging results compares apples &amp; oranges because some predictions are bolder than others), but they are definitely not meaningless. Insights will be vague, because the sample is less than a thousand predictions, and it simply hasn&rsquo;t been that long since I started tracking them.</p>
<p>Here are the takeaways:</p>
<ul>
<li>
<p>Predictions become correct reliably about 25% of the time.</p>
</li>
<li>
<p>Deadline matters: prediction correctness drops to 20% when deadline is 4 days or less in the future or more than a month, sweet spot being about two weeks.</p>
</li>
<li>
<p>80% of all predictions are made for a deadline earlier than or equal to a month in the future.</p>
</li>
<li>
<p>Some influencers are definitely more reliable than others.</p>
</li>
</ul>
<p>I don&rsquo;t want to be thought of as endorsing influencers and I also don&rsquo;t want to talk without sufficient data, but I can say preliminarly that you should probably ignore specific predictions given by:</p>
<ul>
<li>rovercrc</li>
<li>trader1sz</li>
<li>profit8lue</li>
</ul>
<p>And you could listen to (but don&rsquo;t delegate your financial decisions!!!) specific predictions given by:</p>
<ul>
<li>CryptoCapo_</li>
<li>IncomeSharks</li>
<li>CredibleCrypto</li>
</ul>
<p>There are plenty of others, but either they make vague predictions or don&rsquo;t make enough to make statistically significant conclusions (in a 6 month timeframe).</p>
<h2 id="is-there-any-more-value-out-of-this-project">Is there any more value out of this project?</h2>
<p>Evidently, the current state of this project is of little relevance to people. Otherwise, the Twitter account would have more followers and my blogs about it would generate more buzz. Personally, I think anyone following a crypto influencer with the intention of following their advice can only benefit from an impartial, automated track-record for them, but this thought-process makes the assumption that human decisions always makes sense. This has been refuted, and it is really confusing to me.</p>
<p>However, in order to take this project to production I had to build many components that could be used or adapted for other interesting uses.</p>
<h4 id="evaluating-paid-subscriptions-that-offer-cryptocurrency-signals">Evaluating paid subscriptions that offer &ldquo;cryptocurrency signals&rdquo;</h4>
<p>Many individuals or anonymous companies offer a monthly subscription of &ldquo;cryptocurrency signals&rdquo;, which are esentially specific predictions. Those services routinely claim that 80%+ of their signals are profitable.</p>
<p>The only difference between signals and predictions is that signals are not &ldquo;boolean&rdquo;, in that they are not &ldquo;Correct&rdquo; or &ldquo;Incorrect&rdquo;, but instead they have a Profit Margin Ratio, that is, if you action them, you earn or lose a percentage of your investment.</p>
<p>Nobody has ever done a reliable, transparent evaluation of a Cryptocurrency Signal site. It would be too tricky to build the infrastructure necessary to run it. With the tools I&rsquo;ve built, it would be very simple to do this.</p>
<h4 id="building-datasets-for-data-science-experiments">Building datasets for data science experiments</h4>
<p>If you&rsquo;ve ever reviewed any articles that do research based on market data, you&rsquo;ll quickly realise that it&rsquo;s very rare to see any research aggregating data from different exchanges. There is <a href="https://messari.io/">Messari</a>, but I initially implemented it and ended up scrapping it, as I couldn&rsquo;t get reliable results.</p>
<p>The library I open sourced for reading market data, <a href="https://github.com/marianogappa/crypto-candles">crypto-candles</a>, is very efficient and has a very simple interface (it builds iterators), so I think it would be ideal for getting data for experiments.</p>
<p>In general, while there are very good freemium UIs for cryptocurrency data, most notably <a href="tradingview.com">TradingView</a>, there isn&rsquo;t any good free API for getting market data across exchanges. crypto-candles solves this issue as a library you can import, or a CLI you can call.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I think that <a href="https://twitter.com/crypto_preds">Crypto Predictions Tracker</a> was a useful, free warning service for people thinking about following the advice of cryptocurrency influencers. But even if it&rsquo;s not, I really enjoyed building <a href="https://github.com/marianogappa/crypto-predictions">its backend</a>.</p>
<p>Unfortunately, <a href="https://help.heroku.com/RSBRUH58/removal-of-heroku-free-product-plans-faq">Heroku shut down the dynos</a> I was using to power the cron and the API (switched to Render which <a href="https://render.com/pricing">has a free plan with DB &amp; Cron</a>), and <a href="https://techcrunch.com/2023/02/01/twitter-to-end-free-access-to-its-api/">Twitter restricted their API access</a>, so it got too cumbersome to support it. I think there&rsquo;s value that can be repurposed in an eventual iteration.</p>
<p>Thanks for reading, and I hope you can benefit from the tools and services I created. Good luck!</p>
<h2 id="tldr-1">TL;DR</h2>
<p>During the past year I&rsquo;ve gotten exposure to the cryptocurrency scene from an investment perspective. A key frustrating aspect of it is that there&rsquo;s no reliable source of investment advice. I describe this problem in detail on my previous blogpost: <a href="%7B%7Bsite.url%7D%7D/software/2022/08/25/cryptocurrency-influencers-are-preying-on-millennials-who-found-salvation-in-crypto/">Cryptocurrency influencers are preying on millennials who found salvation in crypto</a>.</p>
<p>I&rsquo;ve been working on a Go-based project to automatically track cryptocurrency predictions made on social networks like <a href="https://twitter.com/CryptoKaleo/status/1558313838877057025">this one</a> for the last 6 months, as a tool for accountability and influencer reputation. I think the resulting system ended up being pretty neat and it might interest you if you&rsquo;re a backend engineer. In this blogpost, I&rsquo;ll define this system and describe its architecture.</p>
<p>The backend system is available here: <a href="https://github.com/marianogappa/crypto-predictions">Crypto Predictions Tracker</a>.</p>
<p>A frontend to this project is this Twitter account: <a href="https://twitter.com/crypto_preds">Crypto Predictions Tracker</a>.</p>
<p>A key component of building this project was to consume cryptocurrency market data provided by exchanges. I&rsquo;ve open sourced a library that facilitates this task in a simple and efficient manner. The crypto-candles library is available <a href="https://github.com/marianogappa/crypto-candles">on Github</a> and its construction and features are described on my blogpost: <a href="%7B%7Bsite.url%7D%7D/software/2022/07/27/10-gotchas-for-building-a-universal-crypto-candlestick-iterator-in-go/">10 Gotchas for building a universal crypto candlestick iterator in Go</a>.</p>
<h2 id="motivation-1">Motivation</h2>
<p>A fundamental problem of available cryptocurrency-related investment advice on the Internet is that there is no track-record anywhere. Consider other businesses:</p>
<ul>
<li>
<p>Before making a hotel or restaurant booking, we can check their rating online on our phones.</p>
</li>
<li>
<p>Before making a decision on a rental flat or buying a house, we can compare neighbourhood prices and do inspections.</p>
</li>
<li>
<p>Before choosing an investment fund, we can check <a href="https://am.jpmorgan.com/us/en/asset-management/adv/tools/portfolio-tools/investment-comparison/">comparison studies</a> as well as the historical ROI of the chosen fund itself.</p>
</li>
</ul>
<p>Now consider examples of advice given by cryptocurrency influencers, like this one:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-0.png" alt="Example Tweet"></p>
<p>I&rsquo;m hoping most of you reading this right now will be thinking: &ldquo;why would anyone in their right mind follow the investment advice of some dude on the Internet?&rdquo;. I think so too. However, some of these influencers have more than a million followers! I think it&rsquo;s fair to assume that advice is being followed galore. For a more exhaustive read of this problem, please read my blogpost: <a href="%7B%7Bsite.url%7D%7D/software/2022/08/25/cryptocurrency-influencers-are-preying-on-millennials-who-found-salvation-in-crypto/">Cryptocurrency influencers are preying on millennials who found salvation in crypto</a>.</p>
<p>I don&rsquo;t think all advice is malintentioned, and even if it was, I don&rsquo;t think it should be banned or made illegal, the same way that I don&rsquo;t think smoking, drinking and drugs should be illegal either. However, some form of warning should be available for them, the same way that there are warnings on cigarette packs and ratings on restaurants and hotels. Then, influencers would have a track-record that keeps them honest, and individuals can make informed decisions. But is that possible?</p>
<p><img src="/images/posts/crypto-predictions-tobacco-warning.jpg" alt="Social Network Posts"></p>
<h2 id="key-insights-on-feasibility-1">Key Insights on feasibility</h2>
<p>Note how social network posts are particularly well-suited for keeping a track record:</p>
<p><img src="/images/posts/crypto_social_post.png" alt="Social Network Posts"></p>
<p>They have:</p>
<ul>
<li>
<p>a date</p>
</li>
<li>
<p>an owner</p>
</li>
<li>
<p>mostly reasonably un-editable content</p>
</li>
</ul>
<p>Provided that the content is specific enough, as in the above example, then one could manually go to the exchange&rsquo;s website every now and then and check the market pair&rsquo;s last value against the prediction. In most cases, it&rsquo;s important that the prediction has some deadline: otherwise either we could be checking forever, and besides there&rsquo;s little value on a prediction that can only become true eventually, but never times out and becomes false.</p>
<p>If this can be done manually, can it be automated?</p>
<p>Yes! All exchanges (mostly) provide free APIs to consume current and historical market pair data. Social networks also <del>have free APIs to consume public post metadata</del> (thank you <a href="https://techcrunch.com/2023/02/01/twitter-to-end-free-access-to-its-api/">Twitter</a> &amp; <a href="https://techcrunch.com/2023/04/18/reddit-will-begin-charging-for-access-to-its-api/">Reddit</a>).</p>
<h2 id="automating-the-system-1">Automating the system</h2>
<p>At a high level, automating tracking for one prediction looks like this:</p>
<p><img src="/images/posts/crypto-predictions-system-diagram.png" alt="Crypto Predictions System Diagram"></p>
<ul>
<li>
<p>Manually input the prediction metadata (e.g. who predicts, which market pair, by when, prediction condition) as an object/struct in memory.</p>
</li>
<li>
<p>Every minute or so, ask the exchange for the current last price of the market pair.</p>
</li>
<li>
<p>Upon receiving the new price, check if the prediction condition was met.</p>
</li>
<li>
<p>If condition met, prediction became true!</p>
</li>
<li>
<p>If condition stays false until deadline, prediction became false!</p>
</li>
</ul>
<h2 id="a-million-caveats-1">A million caveats</h2>
<p>While the above looks very simple, every bullet point is trickier than it looks, even before introducing architectural considerations.</p>
<p>Here are some illustrative examples:</p>
<ul>
<li>
<p>A prediction should ideally specify which exchange it is for. There is no one value for a given market pair, that is, the last price of Bitcoin against Tether can differ between the Binance exchange and the Coinbase exchange at the same timestamp, because the last price is defined by the order book, and different exchanges have different order books! This causes two problems: (1) this system must implement ALL exchange APIs, and (2) predictions that don&rsquo;t specify exchange cannot really be tracked accurately, although in practice some assumptions are reasonable.</p>
</li>
<li>
<p>Social networks don&rsquo;t reveal the timezone of post authors, authors don&rsquo;t specify which timezones they make their predictions for, and cryptocurrency influencers typically travel around a lot, so prediction deadlines are imprecise. The closer the deadline, the least precise is the tracking of the prediction.</p>
</li>
<li>
<p>In practice, &gt;80% of predictions are surprisingly homogeneous and simple in structure, in the form: &ldquo;Coin against Stablecoin will reach Value by Deadline&rdquo;. But for some outliers, the discussed algorithm of a prediction being false until it becomes true or times out doesn&rsquo;t work. For example, consider this one: &ldquo;Ethereum won&rsquo;t reach 3000 until December&rdquo;.</p>
</li>
<li>
<p>It would be very lucky if the system would always catch fresh predictions made just now, but in practice the system will input predictions made some time in the past, so old predictions have to &ldquo;catch up to the present&rdquo; by checking the evolution of price since the start of the prediction timestamp, to now. The API endpoints for historical prices and current prices are separate.</p>
</li>
<li>
<p>The last price for a market pair changes with every filled order. On an exchange with a very high volume of transactions, several hundreds of orders could be filled every second. Checking the condition for every order would be the most accurate way to evaluate the prediction, because in theory there could be a very short period of very high price volatility in which the prediction briefly becomes true, and we might miss this fact in an averaged bucket of orders. In practice, this would be unfeasible, especially if we&rsquo;re planning to do it for more than a single prediction.</p>
</li>
</ul>
<h2 id="architectural-building-blocks-1">Architectural building blocks</h2>
<p>At a minimum, these components are going to be required:</p>
<p>![Architecture](/images/posts/crypto-predictions -diagram-blogpost-1.png)</p>
<ul>
<li>
<p>Database: each prediction contains some metadata (e.g. who, what, when) and some state (e.g. last recorded price and when, status of prediction). This data should survive restarts and evolve in atomic steps.</p>
</li>
<li>
<p>Market requester: predictions evolve upon evaluating market data, so the system needs a component that knows how to talk to all Exchange APIs.</p>
</li>
<li>
<p>Social Network requester: predictions are created upon consuming social network post metadata (e.g. who, what, when), so the system needs a component that can request post metadata from e.g. Twitter.</p>
</li>
<li>
<p>Back Office: a minimal frontend to <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> predictions, and to see what happens to them.</p>
</li>
<li>
<p>Cron: a process that will evolve active predictions at regular intervals, with the newest market data.</p>
</li>
</ul>
<p>If we want the system to be useful to a larger population than just its creator, two extra components become relevant:</p>
<ul>
<li>
<p>Frontend: some UI to display the information created, like a website. It could also be some report export function.</p>
</li>
<li>
<p>API: since now there are three components reading data (Cron, Back Office and Frontend), and potentially the Frontend could be consumed by untrusted clients, it becomes important to have a unified interface for managing access to that data.</p>
</li>
</ul>
<h2 id="architectural-challenges-1">Architectural challenges</h2>
<h4 id="implementing-support-for-arbitrary-predictions-1">Implementing support for arbitrary predictions</h4>
<p>A prediction post can be as simple as &ldquo;Bitcoin will be worth 100K in 2022!&rdquo; which can be normalized (with some assumptions) to: &ldquo;BTC against USDT (Tether) in the Binance exchange (spot market as opposed to some other derivatives market) will be greater than or equal to $100,000 within the post&rsquo;s timestamp and the first second of Jan 1st, 2023&rdquo;. That prediction cannot become false before end of year.</p>
<p>As it turns out, 80% or more of the predictions are as simple as that example. Considering the most popular cryptocurrency influencers, there are mostly only a few prediction patterns in total.</p>
<p>Sometimes, an influencer will make their &ldquo;next run predictions&rdquo; like so:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-1.png" alt="Example Tweet"></p>
<p>If we want to support that, we need to add boolean operator support over the initial implementation.</p>
<p>It&rsquo;s quite common to see a pattern of &ldquo;If a cryptocurrency falls below X, it will go all the way down to Y&rdquo;. For example:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-2.png" alt="Example Tweet"></p>
<p>This prediction has two steps: a &ldquo;prerequisite&rdquo; which &ldquo;enables&rdquo; the prediction, and the prediction itself. If the &ldquo;prerequisite&rdquo; is not met, then the prediction is not false but &ldquo;annulled&rdquo;. Often, these predictions cannot be input because they lack specific deadlines.</p>
<p>Finally, some predictions become true if a condition is true until a deadline, like this one:</p>
<p><img src="/images/posts/crypto-predictions-tweet-example-3.png" alt="Example Tweet"></p>
<p>This prediction breaks the model in which a prediction is false unless it becomes true before some deadline.</p>
<p>There are more edge cases, but they are less common, so I won&rsquo;t mention them here. I&rsquo;ve implemented support for many of these patterns and others, and in my experience the problem is not at all the coding &amp; testing involved: the real issue is the UI for inputting and for showing the status of predictions. Rather than providing so much flexibility, it works a lot better to offer a few pre-baked templates, and enable UI support for those.</p>
<h4 id="requesting-market-data-1">Requesting market data</h4>
<p>Predictions posted online tend to follow market trends, so the most popular cryptocurrencies get the most predictions, somewhat following the <a href="https://en.wikipedia.org/wiki/Pareto_principle">80/20 Pareto principle</a>. This means that, if we have 100 predictions and we evolve them every minute, we&rsquo;re gonna be making a lot of identical requests to the exchange&rsquo;s APIs. This is not just very inefficient but also unlikely to last long, because as the number of predictions grow, very soon the exchange&rsquo;s APIs will ban our IPs and ask us to enhance our calm.</p>
<p>The simplest solution to this problem is to cache market responses. In theory, this makes perfect sense, since one wouldn&rsquo;t expect historical market data to change. In practice, this is almost true, but one should be careful to consider some received data point &ldquo;final&rdquo;, since very recent data might be &ldquo;still getting aggregated&rdquo;, and exchanges do not clarify if a data point is final or not. A mitigation is to not consume very recent data points.</p>
<p>Note that the caching component is very valuable, but in a very small window of time. It&rsquo;s not common to need to request old data, because most predictions are about future deadlines. Thus, it&rsquo;s not necessary to build a full-fledged solution for caching.</p>
<h4 id="storing-predictions-and-evolving-them-1">Storing predictions and evolving them</h4>
<p>Predictions are esentially state machines, and they have two parts: metadata (e.g. author, deadline, conditions), and state (e.g. last timestamp requested for each market pair, status of condition(s) that compose the prediction).</p>
<p>Only the state part evolves over time. On each evolution step, one needs to request the latest data points for the involved market pairs, re-evaluate the prediction condition(s) and possibly change the status of it to &ldquo;correct&rdquo;/&ldquo;incorrect&rdquo;.</p>
<p>Further, out of the database of predictions, only a subset evolves: the active predictions. However, the state part of all active predictions must be updated every time. This write pattern suggests using some in-memory layer before reaching the durable store to alleviate disk pressure and latency, although then if someone kicks the power cable progress is lost.</p>
<p>Of course, for a small project that is just starting up and where cost is a major concern, a batch update statement on a small Postgres instance is more than enough. In order to set up the project for growth, we can just hide the storage layer implementation details behind a simple interface.</p>
<h4 id="predictions-tend-to-have-a-common-deadline-1">Predictions tend to have a common deadline</h4>
<p>End of year, end of month, or whenever a big event will take place (e.g. whenever the <a href="https://www.investopedia.com/terms/c/consumerpriceindex.asp">CPI</a> is going to be announced, whenever <a href="https://www.investopedia.com/bitcoin-halving-4843769">the halving</a> happens) are very common instants for predictions. This is absolutely fine in terms of evolving the predictions, but if one plans to trigger some actions like sending out notifications, instant hotspots could be problematic.</p>
<p>Possible mitigations are to buffer and aggregate notifications, or to cap the amount of notifications that can be sent in a given time period.</p>
<h2 id="takeaways-from-tracking-predictions-for-the-last-few-months-1">Takeaways from tracking predictions for the last few months</h2>
<p>A key criticism for this project is that it is pointless to track what influencers say, because no one in their right mind should take their advice when they make their investment decisions. If you share this point of view (like me!), wouldn&rsquo;t it be useful to be able to answer how often predictions become correct?</p>
<h4 id="how-often-do-predictions-become-correct-1">How often do predictions become correct?</h4>
<p>Well, thanks to this project, I can answer that! Results have caveats (e.g. some influencers make more specific predictions than others, averaging results compares apples &amp; oranges because some predictions are bolder than others), but they are definitely not meaningless. Insights will be vague, because the sample is less than a thousand predictions, and it simply hasn&rsquo;t been that long since I started tracking them.</p>
<p>Here are the takeaways:</p>
<ul>
<li>
<p>Predictions become correct reliably about 25% of the time.</p>
</li>
<li>
<p>Deadline matters: prediction correctness drops to 20% when deadline is 4 days or less in the future or more than a month, sweet spot being about two weeks.</p>
</li>
<li>
<p>80% of all predictions are made for a deadline earlier than or equal to a month in the future.</p>
</li>
<li>
<p>Some influencers are definitely more reliable than others.</p>
</li>
</ul>
<p>I don&rsquo;t want to be thought of as endorsing influencers and I also don&rsquo;t want to talk without sufficient data, but I can say preliminarly that you should probably ignore specific predictions given by:</p>
<ul>
<li>rovercrc</li>
<li>trader1sz</li>
<li>profit8lue</li>
</ul>
<p>And you could listen to (but don&rsquo;t delegate your financial decisions!!!) specific predictions given by:</p>
<ul>
<li>CryptoCapo_</li>
<li>IncomeSharks</li>
<li>CredibleCrypto</li>
</ul>
<p>There are plenty of others, but either they make vague predictions or don&rsquo;t make enough to make statistically significant conclusions (in a 6 month timeframe).</p>
<h2 id="is-there-any-more-value-out-of-this-project-1">Is there any more value out of this project?</h2>
<p>Evidently, the current state of this project is of little relevance to people. Otherwise, the Twitter account would have more followers and my blogs about it would generate more buzz. Personally, I think anyone following a crypto influencer with the intention of following their advice can only benefit from an impartial, automated track-record for them, but this thought-process makes the assumption that human decisions always makes sense. This has been refuted, and it is really confusing to me.</p>
<p>However, in order to take this project to production I had to build many components that could be used or adapted for other interesting uses.</p>
<h4 id="evaluating-paid-subscriptions-that-offer-cryptocurrency-signals-1">Evaluating paid subscriptions that offer &ldquo;cryptocurrency signals&rdquo;</h4>
<p>Many individuals or anonymous companies offer a monthly subscription of &ldquo;cryptocurrency signals&rdquo;, which are esentially specific predictions. Those services routinely claim that 80%+ of their signals are profitable.</p>
<p>The only difference between signals and predictions is that signals are not &ldquo;boolean&rdquo;, in that they are not &ldquo;Correct&rdquo; or &ldquo;Incorrect&rdquo;, but instead they have a Profit Margin Ratio, that is, if you action them, you earn or lose a percentage of your investment.</p>
<p>Nobody has ever done a reliable, transparent evaluation of a Cryptocurrency Signal site. It would be too tricky to build the infrastructure necessary to run it. With the tools I&rsquo;ve built, it would be very simple to do this.</p>
<h4 id="building-datasets-for-data-science-experiments-1">Building datasets for data science experiments</h4>
<p>If you&rsquo;ve ever reviewed any articles that do research based on market data, you&rsquo;ll quickly realise that it&rsquo;s very rare to see any research aggregating data from different exchanges. There is <a href="https://messari.io/">Messari</a>, but I initially implemented it and ended up scrapping it, as I couldn&rsquo;t get reliable results.</p>
<p>The library I open sourced for reading market data, <a href="https://github.com/marianogappa/crypto-candles">crypto-candles</a>, is very efficient and has a very simple interface (it builds iterators), so I think it would be ideal for getting data for experiments.</p>
<p>In general, while there are very good freemium UIs for cryptocurrency data, most notably <a href="tradingview.com">TradingView</a>, there isn&rsquo;t any good free API for getting market data across exchanges. crypto-candles solves this issue as a library you can import, or a CLI you can call.</p>
<h2 id="conclusion-1">Conclusion</h2>
<p>I think that <a href="https://twitter.com/crypto_preds">Crypto Predictions Tracker</a> was a useful, free warning service for people thinking about following the advice of cryptocurrency influencers. But even if it&rsquo;s not, I really enjoyed building <a href="https://github.com/marianogappa/crypto-predictions">its backend</a>.</p>
<p>Unfortunately, <a href="https://help.heroku.com/RSBRUH58/removal-of-heroku-free-product-plans-faq">Heroku shut down the dynos</a> I was using to power the cron and the API (switched to Render which <a href="https://render.com/pricing">has a free plan with DB &amp; Cron</a>), and <a href="https://techcrunch.com/2023/02/01/twitter-to-end-free-access-to-its-api/">Twitter restricted their API access</a>, so it got too cumbersome to support it. I think there&rsquo;s value that can be repurposed in an eventual iteration.</p>
<p>Thanks for reading, and I hope you can benefit from the tools and services I created. Good luck!</p>

  </div>
</article>

  </main>
</body>

</html>
